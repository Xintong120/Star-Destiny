# 紫微斗数应用对象和注释

## 核心类

### FunctionalAstrolabe
- **描述**: 星盘类，负责基础命盘数据管理
- **功能**: 提供星盘基础数据和方法
- **主要方法**:
  - `use()`: 插件注入方法
  - `horoscope()`: 获取运限数据
  - `star()`: 通过星耀名称获取星耀对象实例
  - `palace()`: 获取星盘的某一个宫位
  - `surroundedPalaces()`: 获取三方四正宫位

### HoroscopeCalculator
- **描述**: 运限计算器类，专门处理运限计算逻辑
- **功能**: 计算大限、流年、流月、流日、流时等运限数据
- **主要方法**:
  - `calculateHoroscope()`: 计算运限数据

### HoroscopeAdapter
- **描述**: 运限数据适配器，负责格式化运限数据
- **功能**: 将iztro库计算的运限数据转换为应用所需的格式
- **主要方法**:
  - `formatDecadalInfo()`: 格式化大限信息
  - `formatYearInfo()`: 格式化流年信息
  - `formatMonthInfo()`: 格式化流月信息
  - `clearCache()`: 清除缓存

### PalaceNameService
- **描述**: 宫位名称服务类
- **功能**: 处理宫位名称相关的逻辑
- **主要方法**:
  - `getPalaceNames()`: 获取宫位名称

### TimePeriodCalculator
- **描述**: 时间周期计算器
- **功能**: 处理时间周期计算
- **主要方法**:
  - 计算各种时间周期相关的数据

## 状态管理

### horoscopeStore
- **描述**: 运限状态管理Store
- **功能**: 集中管理运限相关的状态和操作
- **主要状态**:
  - `selectedDecadeIndex`: 选中的大限索引
  - `selectedYearIndex`: 选中的流年索引
  - `selectedMonthIndex`: 选中的流月索引
  - `selectedDayIndex`: 选中的流日索引
  - `selectedHourIndex`: 选中的流时索引
  - `selectedHoroscopeInfo`: 选中的运限信息
  - `horoscopeHistory`: 运限历史记录
  - `selectedYear`: 选中的年份
  - `lastViewedAstrolabeId`: 最近查看的命盘ID
- **主要方法**:
  - `selectDecade()`: 选择大限
  - `selectYear()`: 选择流年
  - `selectMonth()`: 选择流月
  - `selectDay()`: 选择流日
  - `selectHour()`: 选择流时
  - `clearSelection()`: 清除选择

### useHoroscope
- **描述**: 运限数据状态管理Hook
- **功能**: 封装运限选择、状态更新等逻辑
- **主要状态**:
  - `selectedDecadeIndex`: 选中的大限索引
  - `selectedYearIndex`: 选中的流年索引
  - `selectedMonthIndex`: 选中的流月索引
  - `selectedHoroscopeInfo`: 选中的运限信息
  - `horoscopeHistory`: 运限历史记录
- **主要方法**:
  - `selectDecade()`: 选择大限
  - `selectYear()`: 选择流年
  - `selectMonth()`: 选择流月
  - `clearSelection()`: 清除选择

## 接口定义

### IFunctionalAstrolabe
- **描述**: 星盘类接口定义
- **主要属性**:
  - `gender`: 性别
  - `solarDate`: 阳历日期
  - `lunarDate`: 农历日期
  - `chineseDate`: 中文日期
  - `time`: 时间
  - `sign`: 星座
  - `zodiac`: 生肖
  - `palaces`: 宫位数组

### IFunctionalHoroscope
- **描述**: 运限功能接口
- **功能**: 定义运限数据的结构和方法

### Decade
- **描述**: 大限数据结构
- **主要属性**:
  - `range`: 大限年龄范围 [开始年龄, 结束年龄]
  - `heavenlyStem`: 天干
  - `earthlyBranch`: 地支

### HoroscopeInfo
- **描述**: 运限信息
- **主要属性**:
  - `decadal`: 大限数据
  - `year`: 流年数据
  - `month`: 流月数据
  - `day`: 流日数据

### CustomHoroscopeInfo
- **描述**: 自定义HoroscopeInfo接口，兼容所有用例
- **主要属性**:
  - `solarDate`: 阳历日期
  - `lunarDate`: 农历日期
  - `decadal`: 大限数据
  - `yearly`: 流年数据
  - `monthly`: 流月数据
  - `daily`: 流日数据
  - `hourly`: 流时数据
  - `age`: 年龄信息

### HoroscopeHistoryItem
- **描述**: 运限历史记录项
- **主要属性**:
  - `type`: 运限类型
  - `data`: 运限数据
  - `fullData`: 完整运限数据
  - `decadeIndex`: 大限索引
  - `yearIndex`: 流年索引
  - `monthIndex`: 流月索引
  - `dayIndex`: 流日索引
  - `comment`: 描述信息
  - `lifePalaceIndex`: 命宫索引

## 组件

### ZiWeiHoroscope
- **描述**: 紫微命盘主组件
- **功能**: 负责UI展示和用户交互
- **主要属性**:
  - `astrolabe`: 命盘对象
- **主要状态**:
  - `stateRestored`: 状态是否已恢复

## 工具函数

### getMutagensByHeavenlyStem
- **描述**: 根据天干获取五行
- **功能**: 计算五行属性

### fixEarthlyBranchIndex
- **描述**: 修正地支索引
- **功能**: 确保地支索引在有效范围内

### timeToIndex
- **描述**: 时间转换为索引
- **功能**: 将小时转换为时辰索引

### normalizeDateStr
- **描述**: 标准化日期字符串
- **功能**: 将日期转换为标准格式

## 数据结构

### EARTHLY_BRANCHES
- **描述**: 地支数组
- **内容**: 十二地支的数据

## 重构优化点

1. **状态管理优化**:
   - 使用Pinia集中管理状态，替代原有的组合式API
   - 实现状态持久化，保存用户选择

2. **代码解耦**:
   - 将运限计算逻辑从FunctionalAstrolabe类移至HoroscopeCalculator类
   - 使用服务类和适配器模式分离关注点

3. **性能优化**:
   - 实现多层缓存机制，避免重复计算
   - 优化渲染性能，减少不必要的更新

4. **类型系统改进**:
   - 完善接口定义，增强类型安全
   - 添加CustomHoroscopeInfo接口，兼容所有用例 